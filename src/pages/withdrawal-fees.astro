---
import Layout from '../layouts/Layout.astro';
import FAQSchema from '../components/FAQSchema.astro';

// M-PESA Agent Withdrawal Fee Bands (KES)
// Updated with 2025 rates
const MPESA_AGENT_FEES = [
  { min: 50, max: 100, fee: 11 },
  { min: 101, max: 500, fee: 29 },
  { min: 501, max: 1000, fee: 29 },
  { min: 1001, max: 1500, fee: 29 },
  { min: 1501, max: 2500, fee: 29 },
  { min: 2501, max: 3500, fee: 52 },
  { min: 3501, max: 5000, fee: 69 },
  { min: 5001, max: 7500, fee: 87 },
  { min: 7501, max: 10000, fee: 115 },
  { min: 10001, max: 15000, fee: 167 },
  { min: 15001, max: 20000, fee: 185 },
  { min: 20001, max: 35000, fee: 197 },
  { min: 35001, max: 50000, fee: 278 },
  { min: 50001, max: 250000, fee: 309 },
];

// M-PESA ATM Withdrawal Fee Bands (KES)
// Updated with 2025 rates
const MPESA_ATM_FEES = [
  { min: 200, max: 2500, fee: 35 },
  { min: 2501, max: 5000, fee: 69 },
  { min: 5001, max: 10000, fee: 115 },
  { min: 10001, max: 35000, fee: 203 },
];

// SEO Metadata
const pageTitle = 'M-PESA Transaction Cost 2025 | Withdrawal & Transfer Fees in Kenya | ConvertKSH';
const pageDescription = 'Check latest M-PESA transaction costs in Kenya (2025). Calculate exact fees for withdrawals, transfers & payments. Compare agent vs ATM charges and save money today.';
const canonicalUrl = '/withdrawal-fees';
const pageUrl = 'https://convertksh.xyz' + canonicalUrl;

// FAQ Schema Data with targeted keywords
const faqItems = [
  {
    question: 'What are the current M-PESA withdrawal charges in Kenya?',
    answer: 'M-PESA withdrawal charges in Kenya range from KES 11 for small amounts (KES 50-100) up to KES 309 for larger withdrawals (KES 50,001-150,000) at agents. ATM withdrawal fees range from KES 35 to KES 203. These mpesa transaction charges are updated for 2025.'
  },
  {
    question: 'How do M-PESA withdrawal fees compare to other transaction charges?',
    answer: 'M-PESA withdrawal charges are typically higher than sending money to other M-PESA users but lower than bank withdrawal fees. For example, sending money to another M-PESA user costs KES 10-108, while withdrawal charges at agents range from KES 11-309.'
  },
  {
    question: 'What are the charges for M-PESA withdrawal at agents vs ATMs?',
    answer: 'Agent withdrawals: KES 11-309 (KES 50-150,000 range). ATM withdrawals: KES 35-203 (KES 200-35,000 range). For amounts under KES 2,500, agents are usually cheaper. Our calculator helps you compare these mpesa charges.'
  },
  {
    question: 'How can I reduce my M-PESA withdrawal fees?',
    answer: 'To minimize mpesa withdrawal charges: 1) Withdraw larger amounts less frequently, 2) Use M-PESA Paybill instead of cash withdrawals when possible, 3) Choose agents over ATMs for amounts under KES 2,500, 4) Look for fee promotions from Safaricom.'
  },
  {
    question: 'What is the minimum withdrawal amount for M-PESA?',
    answer: 'The minimum withdrawal amount is KES 50 at agents and KES 200 at ATMs. These limits help keep mpesa transaction charges reasonable for small transactions.'
  },
  {
    question: 'Are there any hidden charges for M-PESA withdrawals?',
    answer: 'Standard M-PESA withdrawal charges are clearly defined, but be aware that: 1) Some agents may charge extra service fees, 2) Failed transactions may still incur charges, 3) ATM operators might charge additional fees on top of M-PESA withdrawal charges.'
  },
  {
    question: 'How often do M-PESA withdrawal charges change?',
    answer: 'Safaricom typically updates M-PESA charges once a year. The current withdrawal fees are effective from January 2025. We update our calculator immediately when new charges are announced.'
  },
  {
    question: 'What is the most cost-effective way to withdraw large amounts from M-PESA?',
    answer: 'For large M-PESA withdrawals: 1) Use agents for amounts up to KES 150,000 (lower fees than ATMs), 2) Consider bank transfers for very large amounts, 3) Check if your bank offers lower charges for M-PESA to bank transfers compared to direct withdrawals.'
  }
];

// Generate structured data for withdrawal fees
const agentFeeBands = MPESA_AGENT_FEES.map(band => ({
  "@type": "PriceSpecification",
  "price": band.fee,
  "priceCurrency": "KES",
  "eligibleQuantity": {
    "@type": "QuantitativeValue",
    "minValue": band.min,
    "maxValue": band.max,
    "unitCode": "KET"
  }
}));

const atmFeeBands = MPESA_ATM_FEES.map(band => ({
  "@type": "PriceSpecification",
  "price": band.fee,
  "priceCurrency": "KES",
  "eligibleQuantity": {
    "@type": "QuantitativeValue",
    "minValue": band.min,
    "maxValue": band.max,
    "unitCode": "KET"
  }
}));

const structuredData = [
  {
    "@context": "https://schema.org",
    "@type": "WebPage",
    "name": pageTitle,
    "description": pageDescription,
    "url": pageUrl,
    "mainEntity": [
      {
        "@type": "HowTo",
        "name": "How to calculate M-PESA withdrawal fees",
        "description": "Step-by-step guide to calculate M-PESA withdrawal fees for agents and ATMs",
        "step": [
          {
            "@type": "HowToStep",
            "text": "Select withdrawal method (Agent or ATM)"
          },
          {
            "@type": "HowToStep",
            "text": "Enter the amount you want to withdraw"
          },
          {
            "@type": "HowToStep",
            "text": "View the calculated fee and total amount that will be deducted"
          }
        ]
      },
      {
        "@type": "BreadcrumbList",
        "itemListElement": [
          {
            "@type": "ListItem",
            "position": 1,
            "name": "Home",
            "item": "https://convertksh.xyz/"
          },
          {
            "@type": "ListItem",
            "position": 2,
            "name": "M-PESA Withdrawal Fees Calculator"
          }
        ]
      }
    ]
  },
  {
    "@context": "https://schema.org",
    "@type": ["FinancialProduct", "Service"],
    "name": "M-PESA Agent Withdrawal Fees 2025",
    "description": "Current M-PESA agent withdrawal fees in Kenya",
    "provider": {
      "@type": "Organization",
      "name": "Safaricom",
      "url": "https://www.safaricom.co.ke/"
    },
    "feesAndCommissionsSpecification": agentFeeBands,
    "url": pageUrl
  },
  {
    "@context": "https://schema.org",
    "@type": ["FinancialProduct", "Service"],
    "name": "M-PESA ATM Withdrawal Fees 2025",
    "description": "Current M-PESA ATM withdrawal fees in Kenya",
    "provider": {
      "@type": "Organization",
      "name": "Safaricom",
      "url": "https://www.safaricom.co.ke/"
    },
    "feesAndCommissionsSpecification": atmFeeBands,
    "url": pageUrl
  }
];
---

<Layout 
  title={pageTitle}
  description={pageDescription}
  canonicalUrl={canonicalUrl}
  structuredData={structuredData}
>
  <main class="bg-gray-900 text-white min-h-screen p-4 md:p-6 lg:p-8">
    <div class="max-w-6xl mx-auto">
      <nav aria-label="Breadcrumb" class="mb-6">
        <ol class="flex items-center space-x-2 text-sm text-gray-400">
          <li><a href="/" class="hover:text-emerald-400 transition-colors">Home</a></li>
          <li class="text-gray-500">/</li>
          <li class="text-emerald-400">M-PESA Withdrawal Charges</li>
        </ol>
      </nav>
      
      <header class="mb-10 lg:mb-12">
        <div class="max-w-4xl mx-auto text-center lg:text-left">
          <h1 class="text-3xl md:text-4xl lg:text-5xl font-bold mb-4 text-emerald-400 leading-tight">M-PESA Transaction Cost 2025</h1>
          <p class="text-base md:text-lg lg:text-xl text-gray-300 mb-6 max-w-3xl mx-auto lg:mx-0">
            Check current M-PESA transaction costs for withdrawals, transfers, and payments in Kenya. Compare agent vs ATM fees and discover the most affordable way to manage your mobile money.
          </p>
          
          <div class="bg-gradient-to-r from-emerald-900/30 to-emerald-800/20 border border-emerald-800 rounded-xl p-4 md:p-5 max-w-2xl mx-auto lg:mx-0">
            <p class="text-sm md:text-base text-emerald-200">
              <span class="font-semibold">Latest Update (June 2025):</span> Updated with current M-PESA withdrawal charges and fees for 2025.
            </p>
          </div>
        </div>
      </header>
      
      <div class="grid grid-cols-1 xl:grid-cols-4 gap-8">
        <div class="xl:col-span-1">
          <div class="bg-gray-800 p-6 rounded-xl lg:sticky lg:top-6 shadow-lg border border-gray-700">
            <div class="space-y-4">
        <div>
          <label for="withdrawal-method" class="block text-sm font-medium text-gray-300 mb-2">Withdrawal Method</label>
          <select id="withdrawal-method" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base md:text-lg">
            <option value="mpesa-agent">M-PESA Agent</option>
            <option value="mpesa-atm">M-PESA ATM</option>
          </select>
        </div>

        <div>
          <label for="withdrawal-amount" class="block text-sm font-medium text-gray-300 mb-2">Amount to Withdraw (KES)</label>
          <input type="number" id="withdrawal-amount" placeholder="e.g., 5000" class="w-full bg-gray-700 border border-gray-600 rounded-md p-3 text-white focus:ring-2 focus:ring-emerald-500 focus:border-emerald-500 text-base md:text-lg">
        </div>

        <div class="text-center bg-gray-900 p-4 rounded-md mt-6">
          <p class="text-gray-400 text-sm">Withdrawal Fee</p>
          <p id="estimated-fee" class="text-2xl md:text-3xl font-bold text-emerald-400">0.00 KES</p>
          <hr class="border-gray-700 my-2">
          <p class="text-gray-400 text-sm">Total Amount Deducted</p>
          <p id="total-amount" class="text-2xl md:text-3xl font-bold text-white">0.00 KES</p>
        </div>
            </div>
          </div>
        </div>
        <div class="xl:col-span-3">
        <div class="grid gap-8">
          <section class="bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg border border-gray-700" aria-labelledby="agent-charges">
            <h2 id="agent-charges" class="text-2xl font-bold mb-4 text-emerald-400">M-PESA Agent Transaction Costs 2025</h2>
            <p class="text-gray-300 mb-4">The table below shows the current M-PESA transaction costs for cash withdrawals at agents across Kenya. These standard fees apply to all Safaricom M-PESA agents, with costs ranging from KES 11 to KES 309 based on the transaction amount.</p>
            <div class="bg-gray-700 p-4 rounded-lg mb-6">
              <h3 class="font-semibold text-emerald-300 mb-2">Key Points:</h3>
              <ul class="list-disc pl-5 space-y-1 text-gray-300 text-sm">
                <li>Minimum withdrawal: KES 50</li>
                <li>Maximum withdrawal: KES 150,000 per transaction</li>
                <li>No charges for amounts below KES 50</li>
                <li>Standardized fees across all M-PESA agents</li>
              </ul>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-700">
                <thead>
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount Range (KES)</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Fee (KES)</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                  {MPESA_AGENT_FEES.map((range, index) => (
                    <tr key={`agent-${index}`} class={index % 2 === 0 ? 'bg-gray-800' : 'bg-gray-750'}>
                      <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-300">
                        {range.min.toLocaleString()} - {range.max.toLocaleString()}
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium text-white">
                        {range.fee === 0 ? 'FREE' : range.fee.toLocaleString()}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </section>
          
          <section class="bg-gray-800 p-6 md:p-8 rounded-xl shadow-lg border border-gray-700" aria-labelledby="atm-charges">
            <h2 id="atm-charges" class="text-2xl font-bold mb-4 text-emerald-400">M-PESA ATM Transaction Costs 2025</h2>
            <p class="text-gray-300 mb-4">The following table outlines M-PESA transaction costs for ATM withdrawals in Kenya. These fees are charged by Safaricom and are separate from any additional charges that may be applied by your bank. While ATM transactions have a higher minimum amount, they offer 24/7 convenience.</p>
            <div class="bg-gray-700 p-4 rounded-lg mb-6">
              <h3 class="font-semibold text-emerald-300 mb-2">Key Points:</h3>
              <ul class="list-disc pl-5 space-y-1 text-gray-300 text-sm">
                <li>Minimum withdrawal: KES 200</li>
                <li>Maximum withdrawal: KES 35,000 per transaction</li>
                <li>Additional bank charges may apply</li>
                <li>Available 24/7 at all major bank ATMs</li>
              </ul>
            </div>
            <div class="overflow-x-auto">
              <table class="min-w-full divide-y divide-gray-700">
                <thead>
                  <tr>
                    <th class="px-4 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider">Amount Range (KES)</th>
                    <th class="px-4 py-3 text-right text-xs font-medium text-gray-300 uppercase tracking-wider">Fee (KES)</th>
                  </tr>
                </thead>
                <tbody class="divide-y divide-gray-700">
                  {MPESA_ATM_FEES.map((range, index) => (
                    <tr key={`atm-${index}`} class={index % 2 === 0 ? 'bg-gray-800' : 'bg-gray-750'}>
                      <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-300">
                        {range.min.toLocaleString()} - {range.max.toLocaleString()}
                      </td>
                      <td class="px-4 py-3 whitespace-nowrap text-right text-sm font-medium text-white">
                        {range.fee.toLocaleString()}
                      </td>
                    </tr>
                  ))}
                </tbody>
              </table>
            </div>
          </div>
          
          <div class="bg-gray-800 p-6 rounded-lg">
            <h2 class="text-2xl font-bold mb-4 text-emerald-400">Tips to Reduce M-PESA Withdrawal Fees</h2>
            <div class="prose prose-invert max-w-none">
              <ul class="list-disc pl-5 space-y-3">
                <li><strong>Withdraw larger amounts less frequently</strong> - The fee per shilling decreases with larger withdrawals.</li>
                <li><strong>Use M-PESA Paybill for payments</strong> - Many businesses accept direct M-PESA payments which often have lower fees than cash withdrawals.</li>
                <li><strong>Consider bank transfers for large amounts</strong> - For amounts over KES 35,000, a bank transfer might be more cost-effective than multiple withdrawals.</li>
                <li><strong>Use M-PESA for purchases</strong> - Many merchants now accept M-PESA payments directly, eliminating the need to withdraw cash.</li>
                <li><strong>Check for fee promotions</strong> - Safaricom occasionally offers reduced or zero-fee withdrawal promotions.</li>
              </ul>
              
              <h3 class="text-xl font-semibold mt-6 mb-3">Need to withdraw large amounts frequently?</h3>
              <p class="mb-4">If you regularly need to withdraw large sums, consider opening a bank account with a bank that offers free or low-cost transfers from M-PESA to your account, then use your debit card for purchases or ATM withdrawals.</p>
              
              <div class="bg-gray-900 p-4 rounded-lg border-l-4 border-emerald-500 mt-6">
                <h4 class="font-semibold text-emerald-300 mb-2">💡 Did You Know?</h4>
                <p class="text-gray-300">M-PESA withdrawal fees are regulated by the Central Bank of Kenya. The current fee structure was last updated in January 2025 and is valid until further notice.</p>
              </div>
            </div>
          </div>
        </div>
      </div>
      
      <section class="bg-gradient-to-br from-gray-800 to-gray-900 p-8 rounded-2xl shadow-xl border border-gray-700 mb-10">
        <h2 class="text-3xl font-bold mb-8 text-center text-emerald-400">Understanding M-PESA Transaction Costs</h2>
        <p class="text-gray-300 text-center mb-8 max-w-4xl mx-auto">
          M-PESA transaction costs vary based on the type of transaction, amount, and service used. Below are the current rates and tips to help you minimize your transaction expenses.
        </p>
        <h3 class="text-2xl font-bold mb-6 text-center text-emerald-300">Tips to Reduce Your M-PESA Transaction Costs</h3>
        <div class="grid md:grid-cols-2 gap-8 max-w-5xl mx-auto">
          <div>
            <h3 class="text-lg font-semibold mb-3 text-emerald-300">For Everyone</h3>
            <ul class="space-y-3">
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Withdraw larger amounts less frequently</span> - The fee per shilling decreases with larger transactions.</span>
              </li>
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Use M-PESA Paybill for payments</span> - Many businesses accept direct M-PESA payments with lower fees than cash withdrawals.</span>
              </li>
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Make purchases directly with M-PESA</span> - Many merchants now accept M-PESA payments, eliminating the need for cash.</span>
              </li>
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Watch for fee promotions</span> - Safaricom occasionally offers reduced or zero-fee withdrawal promotions.</span>
              </li>
            </ul>
          </div>
          <div>
            <h3 class="text-lg font-semibold mb-3 text-emerald-300">For Businesses & Frequent Users</h3>
            <ul class="space-y-3">
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Consider bank transfers for large amounts</span> - For amounts over KES 35,000, a bank transfer might be more cost-effective than multiple withdrawals.</span>
              </li>
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Open a bank account with M-PESA integration</span> - Some banks offer free or low-cost transfers from M-PESA to your account.</span>
              </li>
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Use M-PESA Business Till</span> - For businesses, this offers better rates and transaction management.</span>
              </li>
              <li class="flex items-start">
                <svg class="h-5 w-5 text-emerald-500 mr-2 mt-0.5 flex-shrink-0" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                </svg>
                <span class="text-gray-300"><span class="font-medium">Compare agent vs ATM fees</span> - Use our calculator above to find the most cost-effective option for your needs.</span>
              </li>
            </ul>
          </div>
        </div>
      </section>
      
      <div class="bg-gradient-to-r from-emerald-900/20 to-emerald-800/10 border border-emerald-800 rounded-2xl p-8 mb-8 max-w-5xl mx-auto">
        <div class="text-center max-w-3xl mx-auto">
          <h3 class="text-2xl font-bold mb-4 text-emerald-300">Need Help With M-PESA Transactions?</h3>
          <p class="mb-6 text-lg text-gray-300">Bookmark this page for quick access to the latest M-PESA charges or share it with friends and family in Kenya.</p>
          <div class="flex flex-wrap justify-center gap-4">
          <button 
            onclick="window.print()" 
            class="bg-emerald-700 hover:bg-emerald-600 text-white px-4 py-2 rounded-lg flex items-center text-sm"
            aria-label="Print this page"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 17h2a2 2 0 002-2v-4a2 2 0 00-2-2H5a2 2 0 00-2 2v4a2 2 0 002 2h2m2 4h6a2 2 0 002-2v-4a2 2 0 00-2-2H9a2 2 0 00-2 2v4a2 2 0 002 2zm8-12V5a2 2 0 00-2-2H9a2 2 0 00-2 2v4h10z"/>
            </svg>
            Print
          </button>
          <button 
            id="shareButton"
            class="bg-gray-700 hover:bg-gray-600 text-white px-4 py-2 rounded-lg flex items-center text-sm"
            aria-label="Share this page"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"/>
            </svg>
            Share
          </button>
          <script>
            document.getElementById('shareButton').addEventListener('click', async () => {
              const shareData = {
                title: document.title,
                text: 'Check out these M-PESA withdrawal charges and calculator',
                url: window.location.href
              };
              
              try {
                if (navigator.share) {
                  await navigator.share(shareData);
                } else {
                  // Fallback: Copy to clipboard and show a message
                  await navigator.clipboard.writeText(window.location.href);
                  alert('Link copied to clipboard!');
                }
              } catch (err) {
                // Fallback: Show a prompt with the URL to copy
                const url = window.location.href;
                const copied = window.prompt('Copy this URL:', url);
                if (copied) {
                  try {
                    await navigator.clipboard.writeText(url);
                    alert('Link copied to clipboard!');
                  } catch (e) {
                    console.error('Failed to copy URL', e);
                  }
                }
              }
            });
          </script>
          <button 
            onclick="window.scrollTo({top: 0, behavior: 'smooth'})" 
            class="bg-gray-800 hover:bg-gray-700 text-white px-4 py-2 rounded-lg flex items-center text-sm ml-auto"
            aria-label="Back to top"
          >
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 10l7-7m0 0l7 7m-7-7v18"/>
            </svg>
            Back to Top
          </button>
        </div>
        </div>
      </section>

      <!-- Related Services Section -->
      <section class="mt-12 mb-16">
        <h2 class="text-2xl font-bold mb-6 text-emerald-400 text-center">Related M-PESA Services</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6 max-w-4xl mx-auto">
          <a href="/send-money-charges" class="group block bg-gradient-to-br from-gray-800 to-gray-900 p-6 rounded-xl border border-gray-700 hover:border-emerald-500 transition-all duration-300 shadow-lg hover:shadow-emerald-900/20">
            <div class="flex items-center">
              <div class="bg-emerald-500/10 p-3 rounded-lg mr-4 group-hover:bg-emerald-500/20 transition-colors">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-8 w-8 text-emerald-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" />
                </svg>
              </div>
              <div>
                <h3 class="text-lg font-semibold text-white group-hover:text-emerald-400 transition-colors">M-PESA Send Money Charges</h3>
                <p class="text-sm text-gray-400 mt-1">Calculate exact fees for sending money to other M-PESA users and mobile numbers</p>
              </div>
              <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-auto text-gray-500 group-hover:text-emerald-400 transition-colors" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 5l7 7m0 0l-7 7m7-7H3" />
              </svg>
            </div>
          </a>
        </div>
      </section>
    </div>
  </main>
</Layout>
  <script>
    // Define the fee structures for different withdrawal methods
    const MPESA_AGENT_FEES = [
      { min: 50, max: 100, fee: 11 },
      { min: 101, max: 500, fee: 29 },
      { min: 501, max: 1000, fee: 29 },
      { min: 1001, max: 1500, fee: 29 },
      { min: 1501, max: 2500, fee: 29 },
      { min: 2501, max: 3500, fee: 52 },
      { min: 3501, max: 5000, fee: 69 },
      { min: 5001, max: 7500, fee: 87 },
      { min: 7501, max: 10000, fee: 115 },
      { min: 10001, max: 15000, fee: 167 },
      { min: 15001, max: 20000, fee: 185 },
      { min: 20001, max: 35000, fee: 197 },
      { min: 35001, max: 50000, fee: 278 },
      { min: 50001, max: 250000, fee: 309 },
    ];

    const MPESA_ATM_FEES = [
      { min: 200, max: 2500, fee: 35 },
      { min: 2501, max: 5000, fee: 69 },
      { min: 5001, max: 10000, fee: 115 },
      { min: 10001, max: 35000, fee: 203 },
    ];

    document.addEventListener('DOMContentLoaded', () => {
      const amountInput = document.getElementById('withdrawal-amount');
      const methodSelect = document.getElementById('withdrawal-method');
      const feeDisplay = document.getElementById('estimated-fee');
      const totalDisplay = document.getElementById('total-amount');

      if (!amountInput || !methodSelect || !feeDisplay || !totalDisplay) {
        console.error('Withdrawal Fee script: One or more required DOM elements are missing.');
        return;
      }

      function calculateMpesaAgentFee(amount) {
        if (isNaN(amount) || amount < 50) return 0; // No withdrawals below 50
        if (amount > 250000) return -1; // Indicate error/over limit

        // Convert amount to number in case it's a string
        const numAmount = Number(amount);
        
        for (const band of MPESA_AGENT_FEES) {
          if (numAmount >= band.min && numAmount <= band.max) {
            return band.fee;
          }
        }
        return -1; // Return -1 if no matching band found
      }

      function calculateAtmFee(amount) {
        if (isNaN(amount) || amount < 200) return 0;
        if (amount > 35000) return -1; // Over limit

        const numAmount = Number(amount);
        
        for (const band of MPESA_ATM_FEES) {
          if (numAmount >= band.min && numAmount <= band.max) {
            return band.fee;
          }
        }
        return -1; // No matching band found
      }

      function updateCalculation() {
        const amount = amountInput.value.trim() === '' ? 0 : parseFloat(amountInput.value);
        const method = methodSelect.value;

        if (isNaN(amount) || amount <= 0) {
          feeDisplay.textContent = '0.00 KES';
          totalDisplay.textContent = '0.00 KES';
          return;
        }


        let fee = 0;
        let errorMessage = '';
        
        if (method === 'mpesa-agent') {
          if (amount < 50) {
            errorMessage = 'Min: 50 KES';
          } else if (amount > 250000) {
            errorMessage = 'Max: 250,000 KES';
          } else {
            fee = calculateMpesaAgentFee(amount);
          }
        } else if (method === 'mpesa-atm') {
          if (amount < 200) {
            errorMessage = 'Min: 200 KES';
          } else if (amount > 35000) {
            errorMessage = 'Max: 35,000 KES';
          } else {
            fee = calculateAtmFee(amount);
          }
        }

        if (errorMessage) {
          feeDisplay.textContent = 'N/A';
          totalDisplay.textContent = errorMessage;
          return;
        }

        const totalAmount = amount + fee;

        feeDisplay.textContent = fee === 0 ? 'FREE' : `${fee.toLocaleString('en-KE')} KES`;
        totalDisplay.textContent = `${totalAmount.toLocaleString('en-KE')} KES`;
      }

      amountInput.addEventListener('input', updateCalculation);
      methodSelect.addEventListener('change', updateCalculation);
      
      updateCalculation(); // Initial calculation
    });
  </script>
  
  <!-- FAQ Schema for Rich Results -->
  <FAQSchema faqItems={faqItems} />
</main>
</Layout>
