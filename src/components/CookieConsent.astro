---
// This component handles the cookie consent banner
const cookieName = 'cookie-consent';
const cookieExpiry = 365; // days
---

<div id="cookie-consent-banner" class="hidden fixed bottom-0 left-0 right-0 bg-gray-800 text-white p-4 shadow-lg z-50">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col md:flex-row justify-between items-start md:items-center gap-4">
      <div class="flex-1">
        <p class="text-sm">
          We use cookies to enhance your experience and analyze site traffic. By clicking "Accept All", you consent to our use of cookies.
          <a href="/cookie-policy" class="text-emerald-400 hover:underline ml-1">Learn more</a>
        </p>
      </div>
      <div class="flex flex-col sm:flex-row gap-3 w-full md:w-auto">
        <button id="accept-cookies" class="px-4 py-2 bg-emerald-600 hover:bg-emerald-700 text-white rounded-md text-sm font-medium whitespace-nowrap">
          Accept All
        </button>
        <button id="reject-cookies" class="px-4 py-2 bg-transparent border border-gray-600 hover:bg-gray-700 text-white rounded-md text-sm font-medium whitespace-nowrap">
          Reject Non-Essential
        </button>
      </div>
    </div>
  </div>
</div>

<script is:inline>
  document.addEventListener('DOMContentLoaded', function() {
    const banner = document.getElementById('cookie-consent-banner');
    const acceptBtn = document.getElementById('accept-cookies');
    const rejectBtn = document.getElementById('reject-cookies');
    
    // Check if user has already made a choice
    if (!getCookie('cookie-consent')) {
      banner.classList.remove('hidden');
    }
    
    // Handle accept all
    if (acceptBtn) {
      acceptBtn.addEventListener('click', function() {
        setCookie('cookie-consent', 'all', 365);
        banner.classList.add('hidden');
        // Enable Google Analytics
        enableAnalytics();
      });
    }
    
    // Handle reject non-essential
    if (rejectBtn) {
      rejectBtn.addEventListener('click', function() {
        setCookie('cookie-consent', 'necessary', 365);
        banner.classList.add('hidden');
        // Disable Google Analytics
        disableAnalytics();
      });
    }
    
    // Cookie helper functions
    function setCookie(name, value, days) {
      let expires = '';
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = '; expires=' + date.toUTCString();
      }
      document.cookie = name + '=' + (value || '') + expires + '; path=/' + '; SameSite=Lax';
    }
    
    function getCookie(name) {
      const nameEQ = name + '=';
      const ca = document.cookie.split(';');
      for (let i = 0; i < ca.length; i++) {
        let c = ca[i];
        while (c.charAt(0) === ' ') c = c.substring(1, c.length);
        if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
      }
      return null;
    }
    
    function enableAnalytics() {
      // Enable Google Analytics
      window['ga-disable-G-KPS5WNEY4T'] = false;
      // If you're using gtag.js, you might need to trigger a page view
      if (window.gtag) {
        gtag('consent', 'update', {
          'analytics_storage': 'granted'
        });
        gtag('event', 'consent_update', {
          'event_category': 'consent',
          'event_label': 'accepted'
        });
      }
    }
    
    function disableAnalytics() {
      // Disable Google Analytics
      window['ga-disable-G-KPS5WNEY4T'] = true;
      // Clear existing data
      if (window.gtag) {
        gtag('consent', 'update', {
          'analytics_storage': 'denied'
        });
      }
    }
    
    // Check consent on page load and apply settings
    const consent = getCookie('cookie-consent');
    if (consent === 'all') {
      enableAnalytics();
    } else if (consent === 'necessary') {
      disableAnalytics();
    }
  });
</script>
